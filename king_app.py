import streamlit as st
import os
import smtplib
from email.mime.text import MIMEText

# üîπ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
st.set_page_config(page_title="Happy Valentine's Day üíñ", page_icon="üíå", layout="centered")

# üîπ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å GitHub
GITHUB_REPO = "https://raw.githubusercontent.com/narainritjaksoongnern22/king/main/"
def get_image_url(filename):
    return f"{GITHUB_REPO}{filename}"

# üîπ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
if "answers" not in st.session_state:
    st.session_state.answers = []
if "page" not in st.session_state:
    st.session_state.page = "home"

# üîπ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏ã‡πà‡∏≠‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
HIDDEN_ANSWERS_FILE = "hidden_answers.txt"
YOUR_EMAIL = "narainritjaksoongnern22@gmail.com"  # üî• ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡πÄ‡∏ò‡∏≠

# üîπ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡∏•‡∏±‡∏ö
def save_hidden_answers():
    answers_text = "üíñ ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏û‡∏µ‡πà‡∏Ñ‡∏¥‡∏á üíñ\n\n"
    for i, (question, answer) in enumerate(zip(questions, st.session_state.answers)):
        answers_text += f"{i+1}. {question[0]} ‚Üí {answer}\n"

    with open(HIDDEN_ANSWERS_FILE, "a", encoding="utf-8") as f:  # üî• ‡πÉ‡∏ä‡πâ "a" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÑ‡∏°‡πà‡∏•‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤)
        f.write(answers_text + "\n---\n")

    # üî• ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏õ‡πÉ‡∏´‡πâ‡πÄ‡∏ò‡∏≠ (‡πÄ‡∏ò‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡πá‡∏ô)
    send_email(answers_text)

# üîπ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏• (‡πÉ‡∏´‡πâ‡πÄ‡∏ò‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡πá‡∏ô)
def send_email(content):
    try:
        sender_email = "your-email@gmail.com"  # üî• ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ Gmail ‡∏à‡∏£‡∏¥‡∏á (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏™‡∏≥‡∏£‡∏≠‡∏á)
        sender_password = "your-app-password"  # üî• ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ "App Password" (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥)
        recipient_email = YOUR_EMAIL

        msg = MIMEText(content)
        msg["Subject"] = "üíñ ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏û‡∏µ‡πà‡∏Ñ‡∏¥‡∏á üíñ"
        msg["From"] = sender_email
        msg["To"] = recipient_email

        with smtplib.SMTP_SSL("smtp.gmail.com", 465) as server:
            server.login(sender_email, sender_password)
            server.sendmail(sender_email, recipient_email, msg.as_string())

        st.success("‚úÖ ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏û‡∏µ‡πà‡∏Ñ‡∏¥‡∏á‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡πÄ‡∏ò‡∏≠‡πÅ‡∏•‡πâ‡∏ß!")

    except Exception as e:
        st.error(f"‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏î‡πâ: {e}")

# üîπ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (‡πÄ‡∏ò‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡πá‡∏ô!)
def show_hidden_answers():
    st.markdown("<h3 style='color: red;'>üîí ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏û‡∏µ‡πà‡∏Ñ‡∏¥‡∏á (‡πÄ‡∏ò‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡πá‡∏ô!)</h3>", unsafe_allow_html=True)
    
    if os.path.exists(HIDDEN_ANSWERS_FILE):
        with open(HIDDEN_ANSWERS_FILE, "r", encoding="utf-8") as f:
            hidden_answers = f.read()
            st.text_area("üìú ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏û‡∏µ‡πà‡∏Ñ‡∏¥‡∏á", hidden_answers, height=300)

        # ‚úÖ ‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏ò‡∏≠‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÑ‡∏õ‡∏î‡∏π‡πÄ‡∏≠‡∏á
        st.download_button(
            label="üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏û‡∏µ‡πà‡∏Ñ‡∏¥‡∏á",
            data=hidden_answers,
            file_name="king_answers.txt",
            mime="text/plain"
        )
    else:
        st.warning("‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å")

# üîπ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
def start_game():
    st.session_state.answers = []  # üî• ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
    st.write("üéÆ **‡πÄ‡∏Å‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß!** ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ:")
    
    for i, (question, options) in enumerate(questions):
        answer = st.radio(
            f"**{i+1}. {question}**",
            options,
            index=None,  # üî• ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            key=f"q{i}"
        )
        st.session_state.answers.append(answer)
    
    if st.button("üì§ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡∏•‡∏±‡∏ö"):
        save_hidden_answers()
        st.success("‚úÖ ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏û‡∏µ‡πà‡∏Ñ‡∏¥‡∏á‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! (‡πÄ‡∏ò‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π‡πÑ‡∏î‡πâ)")
        st.session_state.page = "final"
        st.rerun()

# üîπ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
def show_final_message():
    st.markdown("<h2 style='text-align: center; color: red;'>‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ô‡∏∞‡∏á‡∏±‡∏ö‡∏û‡∏µ‡πà‡∏Ñ‡∏¥‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏ô‡∏µ‡πâ! üíñ</h2>", unsafe_allow_html=True)

    if st.button("üîé ‡∏î‡∏π‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏û‡∏µ‡πà‡∏Ñ‡∏¥‡∏á"):
        show_hidden_answers()

    if st.button("üéâ ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ üéâ"):
        st.session_state.page = "special"
        st.rerun()

# üîπ ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
questions = [
    ("üíñ ‡∏û‡∏µ‡πà‡∏Ñ‡∏¥‡∏á‡∏ä‡∏≠‡∏ö‡∏Ñ‡∏ô‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô?", ["‡∏Ç‡∏µ‡πâ‡∏≠‡πâ‡∏≠‡∏ô", "‡∏Ç‡∏µ‡πâ‡πÄ‡∏•‡πà‡∏ô", "‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô", "‡∏™‡∏≤‡∏¢‡∏•‡∏∏‡∏¢"]),
    ("üåç ‡∏û‡∏µ‡πà‡∏Ñ‡∏¥‡∏á‡∏ä‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô?", ["‡∏†‡∏π‡πÄ‡∏Ç‡∏≤", "‡∏ó‡∏∞‡πÄ‡∏•", "‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà", "‡∏≠‡∏¢‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô"]),
    ("üçú ‡∏û‡∏µ‡πà‡∏Ñ‡∏¥‡∏á‡∏ä‡∏≠‡∏ö‡∏Å‡∏¥‡∏ô‡∏≠‡∏∞‡πÑ‡∏£?", ["‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô", "‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏∞‡∏ó‡∏∞", "‡∏™‡πâ‡∏°‡∏ï‡∏≥", "‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô"]),
    ("üé∂ ‡∏û‡∏µ‡πà‡∏Ñ‡∏¥‡∏á‡∏ä‡∏≠‡∏ö‡∏ü‡∏±‡∏á‡πÄ‡∏û‡∏•‡∏á‡πÅ‡∏ô‡∏ß‡πÑ‡∏´‡∏ô?", ["‡∏õ‡πä‡∏≠‡∏õ", "‡∏•‡∏π‡∏Å‡∏ó‡∏∏‡πà‡∏á", "‡πÅ‡∏£‡πá‡∏õ", "‡∏£‡πá‡∏≠‡∏Å"]),
    ("üì∫ ‡∏û‡∏µ‡πà‡∏Ñ‡∏¥‡∏á‡∏î‡∏π‡∏´‡∏ô‡∏±‡∏á‡πÅ‡∏ô‡∏ß‡πÑ‡∏´‡∏ô?", ["‡πÇ‡∏£‡πÅ‡∏°‡∏ô‡∏ï‡∏¥‡∏Å", "‡πÅ‡∏≠‡∏Ñ‡∏ä‡∏±‡πà‡∏ô", "‡∏™‡∏¢‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç", "‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏î‡∏µ‡πâ"]),
    ("üê∂ ‡∏û‡∏µ‡πà‡∏Ñ‡∏¥‡∏á‡∏ä‡∏≠‡∏ö‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ï‡∏±‡∏ß‡πÑ‡∏´‡∏ô‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î?", ["‡∏´‡∏°‡∏≤", "‡πÅ‡∏°‡∏ß", "‡∏Å‡∏£‡∏∞‡∏ï‡πà‡∏≤‡∏¢", "‡∏ô‡∏Å‡πÅ‡∏Å‡πâ‡∏ß"]),
    ("üéÅ ‡∏ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏î‡πâ‡∏≠‡∏∞‡πÑ‡∏£?", ["‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ", "‡∏Ç‡∏ô‡∏°", "‡∏ï‡∏∏‡πä‡∏Å‡∏ï‡∏≤", "‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏û‡∏£‡∏™‡πå"]),
    ("üíå ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡∏ô‡πÅ‡∏≠‡∏ö‡∏ä‡∏≠‡∏ö‡∏û‡∏µ‡πà‡∏Ñ‡∏¥‡∏á ‡∏û‡∏µ‡πà‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡πÄ‡∏Ç‡∏≤‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡πÑ‡∏á?", ["‡∏ö‡∏≠‡∏Å‡∏ï‡∏£‡∏á ‡πÜ", "‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°", "‡πÅ‡∏≠‡∏ö‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á‡πÉ‡∏´‡πâ", "‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏≠‡∏Å"]),
    ("üòç ‡∏û‡∏µ‡πà‡∏Ñ‡∏¥‡∏á‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏õ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡∏°‡∏±‡πâ‡∏¢? üíï", ["‡πÑ‡∏õ!"])
]

# üîπ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á
if st.session_state.page == "home":
    show_home()
elif st.session_state.page == "letter":
    show_letter()
elif st.session_state.page == "password":
    ask_password()
elif st.session_state.page == "game":
    start_game()
elif st.session_state.page == "final":
    show_final_message()
